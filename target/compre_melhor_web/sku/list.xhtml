<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"> 

	<ui:composition template="../template/mainLayout.xhtml">
		<ui:define name="content">
			<h:form id="form">
				<p:messages id="messages" globalOnly="true" autoUpdate="true" closable="true"/>
				<div class="ui-panel ui-widget ui-widget-content ui-corner-all header">
					<h3>#{msg['header.h3.sku.list']}</h3>
				</div>
			
				<p:dataTable id="skuTb" widgetVar="skuTable"
				value="#{skuController.skus}" var="sku" 
				rowStyleClass="disabledSku"
				selectionMode="single" selection="#{skuController.skuTarget}"
				rowKey="#{sku.id}"
				paginator="true"
				paginatorPosition="bottom"
				rows="10"
				filteredValue="#{skuController.filteredSkus}"
				emptyMessage="#{msg['sku.filter.no.match']}"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink}
				{PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}
				{RowsPerPageDropdown}"
				currentPageReportTemplate="({startRecord} - {endRecord}) de
					{totalRecords} #{msg['reference.name.skus']}"
					rowsPerPageTemplate="5,10,15">
					
						<p:ajax event="rowSelect" update="@this"
						listener="#{skuController.onRowSelected(event)}"/>
						
						<p:column filterBy="#{sku.id}">
							<f:facet name="header">
								<h:outputText value="ID"/>
							</f:facet>					
						
							<h:outputText value="#{sku.id}"/>
						</p:column>	
							
						<p:column filterBy="#{sku.name}"
							filterMatchMode="contains">
							<f:facet name="header">
								<h:outputText value="#{msg['reference.name.label.column']}"/>
							</f:facet>
							<h:outputText value="#{sku.name}"/>
						</p:column>
						
						<p:column filterBy="#{sku.unit}"
							filterMatchMode="startsWith">
							<f:facet name="header">
								<h:outputText value="#{msg['reference.unit.label.column']}"/>
							</f:facet>
							<h:outputText value="#{sku.unit}"/>
						</p:column>
						
						<p:column filterBy="#{sku.code}" filterMatchMode="startsWith">
							<f:facet name="header">
								<h:outputText value="#{msg['reference.code.label.column']}"/>
							</f:facet>
							<h:outputText value="#{sku.code}"/>
						</p:column>
						
						<p:column filterBy="#{sku.category.name}" 
							filterMatchMode="startsWith">
							<f:facet name="header">
								<h:outputText value="#{msg['reference.category.label.column']}"/>
							</f:facet>
							<h:outputText value="#{sku.category.name}"/>
						</p:column>
						
						<p:column filterBy="#{sku.status}" filterMatchMode="startsWith">
							<f:facet name="header">
								<h:outputText value="#{msg['reference.status.label.column']}"/>
							</f:facet>
							<h:outputText value="#{sku.status}"/>
						</p:column>
						
						<p:column filterBy="#{sku.manufacturer.name}" filterMatchMode="contains">
							<f:facet name="header">
								<h:outputText value="#{msg['reference.manufacturer.label.column']}"/>
							</f:facet>
							<h:outputText value="#{sku.manufacturer.name}"/>
						</p:column>
						
						<p:column filterBy="#{sku.dateCreated}" filterMatchMode="startsWith">
							<f:facet name="header">
								<h:outputText value="#{msg['reference.datecreated.label.column']}"/>
							</f:facet>
							<h:outputText value="#{sku.dateCreated}">
								<f:converter converterId="localDateTimeConverter" />
							</h:outputText>
						</p:column>
						
						<p:column filterBy="#{sku.lastUpdated}" filterMatchMode="startsWith">
							<f:facet name="header">
								<h:outputText value="#{msg['reference.lastupdated.label.column']}"/>
							</f:facet>
							<h:outputText value="#{sku.lastUpdated}">
								<f:converter converterId="localDateTimeConverter" />
							</h:outputText>
						</p:column>
				</p:dataTable>

				<p:commandButton value="Export to Excel" ajax="false">
					<p:dataExporter type="xls" target="skuTb" fileName="users"/>
				</p:commandButton>			

				<p:commandButton value="Export to PDF" ajax="false">
					<p:dataExporter type="pdf" target="skuTb" fileName="users"/>
				</p:commandButton>			


				<p:dialog id="optionsDialog" widgetVar="optDlg" closeOnEscape="true"
					header="#{msg['options']}" >
					<h:form>							
						<h:panelGrid columns="2">
							<h:outputText value="ID:" />
							<h:outputText value="#{skuController.skuTarget.id}"/>
							
							<h:outputText value="Nome: "/>
							<h:outputText value="#{skuController.skuTarget.name}"/>

							<p:commandButton rendered="#{skuController.skuTarget.status == 'DELETADO'}"  styleClass="text-align: center;"
								value="Publicar"
								update="@all"
								onsuccess="optDlg.hide()"
								action="#{skuController.publishSku(skuController.skuTarget)}">
									
								<p:confirm header="Confirmacao" 
								message="Voce tem certeza que deseja publicar este produto (ID:#{skuController.skuTarget.id})?"
								icon="ui-icon-alert"
								/>				
							</p:commandButton>
							
							<p:commandButton rendered="#{skuController.skuTarget.status == 'PUBLICADO'}"
								value="Deletar"
								update="@all"
								onsuccess="optDlg.hide()"
								action="#{skuController.deleteSku(skuController.skuTarget)}">
									
								<p:confirm header="Confirmacao" 
								message="Voce tem certeza que deseja excluir este produto (ID:#{skuController.skuTarget.id})?"
								icon="ui-icon-alert"
								/>
								
							</p:commandButton>
							<p:commandButton value="Editar" 
								onsuccess="optDlg.hide()" action="#{skuController.openEditForm(skuController.skuTarget)}"/>
						</h:panelGrid>
							
					</h:form> 
				</p:dialog>
			</h:form>
			
			<p:confirmDialog global="true">
				<p:commandButton value="Sim"
						type="button"
						styleClass="ui-confirmdialog-yes" 
						icon="ui-icon-check"/>
					
				<p:commandButton value="NÃ£o"
					type="button" 
					styleClass="ui-confirmdialog-no" 
					icon="ui-icon-close"/>
			</p:confirmDialog>
		</ui:define>
	</ui:composition>	
</html>
